<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>YAWATA CASINO</title>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
   <style>
    :root {
        --bg: #050510;
        --accent: #0ff;
        --accent2: #ff00ff;
        --panel: #0b0b1a;
        --text: #e0ffff;
    }

    * { box-sizing: border-box; }

    body {
        margin: 0;
        min-height: 100vh;
        background: radial-gradient(circle at top, #202040 0, #050510 55%, #000 100%);
        font-family: "Segoe UI", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
        color: var(--text);
        text-align: center;
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    header { padding: 25px 10px 10px; }

    h1 {
        margin: 0;
        font-size: 2.6rem;
        letter-spacing: 0.15em;
        text-shadow: 0 0 10px var(--accent), 0 0 25px var(--accent2), 0 0 40px #fff;
    }

    h1 span { display: inline-block; transform: skewX(-8deg); }

    #chipBar {
        margin-top: 10px;
        display: inline-flex;
        align-items: center;
        gap: 10px;
        padding: 6px 14px;
        border-radius: 999px;
        background: linear-gradient(90deg, rgba(0, 255, 255, 0.15), rgba(255, 0, 255, 0.15));
        border: 1px solid rgba(0, 255, 255, 0.5);
        box-shadow: 0 0 15px rgba(0, 255, 255, 0.4);
        font-weight: bold;
    }

    #chips { font-size: 1.4rem; color: #fff; text-shadow: 0 0 8px var(--accent); }

    /* „É°„Ç§„É≥„É¨„Ç§„Ç¢„Ç¶„Éà„ÅÆ‰øÆÊ≠£ */
    main {
        width: 100%;
        max-width: 1200px;
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 20px;
        padding: 20px;
    }

    /* ÂêÑ„Çª„ÇØ„Ç∑„Éß„É≥„ÅÆÊû†Á∑ö„ÇíÂæ©Ê¥ª */
    .section {
        background: radial-gradient(circle at top left, #1a1a3a, #050510 60%);
        border-radius: 18px;
        padding: 20px;
        border: 1px solid rgba(0, 255, 255, 0.4);
        box-shadow: 0 0 25px rgba(0, 255, 255, 0.25), 0 0 40px rgba(255, 0, 255, 0.15);
        display: flex;
        flex-direction: column;
        min-width: 320px;
        flex: 1;
    }

    /* „ÉÅ„É£„ÉÉ„Éà„Çª„ÇØ„Ç∑„Éß„É≥„ÇíÊ®™Èï∑„Å´Áã¨Á´ã */
    .chat-section {
        flex: 1 1 100%;
        max-width: 1060px;
    }

    .control-row { display: flex; justify-content: center; gap: 8px; margin-bottom: 10px; }

    input[type="number"], input[type="text"], input[type="password"] {
        padding: 6px 12px;
        border-radius: 999px;
        border: 1px solid rgba(0, 255, 255, 0.6);
        background: rgba(0, 0, 0, 0.6);
        color: var(--text);
    }

    button {
        background: linear-gradient(135deg, #111, #222);
        color: var(--accent);
        border-radius: 999px;
        border: 1px solid rgba(0, 255, 255, 0.7);
        padding: 7px 18px;
        cursor: pointer;
        font-weight: 600;
        transition: 0.1s;
    }

    button:hover {
        background: var(--accent);
        color: #000;
        box-shadow: 0 0 12px var(--accent);
    }

    button:disabled {
        opacity: 0.3;
        cursor: not-allowed;
    }

    .slot-frame {
        font-size: 2.4rem;
        margin: 10px 0;
        padding: 10px;
        border-radius: 14px;
        border: 1px solid rgba(0, 255, 255, 0.6);
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        justify-content: center;
        gap: 15px;
    }

    .result { margin-top: 8px; min-height: 22px; font-weight: bold; }
    .win { color: #00ff9d; text-shadow: 0 0 8px #00ff9d; }
    .lose { color: #ff4d6a; text-shadow: 0 0 8px #ff4d6a; }

    #loginOverlay {
        position: fixed; inset: 0; background: var(--bg);
        display: flex; justify-content: center; align-items: center; z-index: 1000;
    }

    /* „Éà„É©„É≥„Éó„Éá„Ç∂„Ç§„É≥ */
    .card-row { display: flex; justify-content: center; gap: 10px; min-height: 100px; padding: 10px; }
    .card-ui {
        display: inline-flex; justify-content: center; align-items: center;
        width: 52px; height: 72px; border-radius: 10px;
        background: #fdfdfd; color: #000; font-weight: bold; font-size: 1.2rem;
        box-shadow: 0 4px 10px rgba(0,0,0,0.5), 0 0 5px var(--accent);
        border: 1px solid #ddd;
    }
    .card-ui.red { color: #c00; }
    .card-ui.back {
        background: linear-gradient(135deg, var(--accent) 0%, var(--accent2) 100%);
        border: 2px solid #fff;
    }

    /* LINEÈ¢®„ÉÅ„É£„ÉÉ„Éà„ÅÆ„Éá„Ç∂„Ç§„É≥ */
    #chat-log {
        display: flex;
        flex-direction: column;
        padding: 15px;
        background: #7494c0;
        border-radius: 12px;
        overflow-y: auto;
        height: 350px;
        text-align: left;
        border: 2px solid rgba(0,0,0,0.2);
    }

    .msg-box {
        max-width: 70%;
        margin: 5px 0;
        padding: 10px 14px;
        border-radius: 18px;
        word-wrap: break-word;
        font-size: 14px;
        line-height: 1.4;
    }

    .msg-other {
        align-self: flex-start;
        background: white;
        color: black;
        border-bottom-left-radius: 4px;
    }

    .msg-me {
        align-self: flex-end;
        background: #85e085;
        color: black;
        border-bottom-right-radius: 4px;
    }

    .msg-info {
        font-size: 11px;
        color: #fff;
        margin: 8px 5px 2px;
    }
</style>
</head>
<body>

<div id="loginOverlay">
    <div class="section" style="width:320px;">
        <h2 style="color:var(--accent);">LOGIN / SIGNUP</h2>
        <div style="margin-top:20px;">
            <input type="text" id="uName" placeholder="PLAYER NAME" style="width:100%; margin-bottom:10px;"><br>
            <input type="password" id="uPass" placeholder="PASSWORD" style="width:100%; margin-bottom:20px;"><br>
            <button onclick="login()" style="width:100%;">ACCESS SYSTEM</button>
            <p id="err" style="color:var(--accent2); font-size:0.8rem; margin-top:10px;"></p>
        </div>
    </div>
</div>

<header>
    <h1><span>YAWATA</span> CASINO</h1>
    <div id="chipBar">
        STATUS: <span id="chips">0</span> CHIPS
    </div>
    <div style="margin-top:10px; font-size:0.9rem;">PLAYER: <span id="myName">-</span></div>
</header>

<main>
    <div class="section">
        <div class="section-title"><span class="label">Cyber Slot</span></div>
        <div id="gogoLamp" style="color: #222; font-weight: bold; font-size: 1.5rem;">GOGO!</div>
        <div class="slot-frame" style="display: flex; justify-content: center; gap: 10px;">
            <div id="reel0">‚ùì</div>
            <div id="reel1">‚ùì</div>
            <div id="reel2">‚ùì</div>
        </div>
        <div class="control-row">
            <button id="stop0" onclick="stopReel(0)" disabled>STOP 1</button>
            <button id="stop1" onclick="stopReel(1)" disabled>STOP 2</button>
            <button id="stop2" onclick="stopReel(2)" disabled>STOP 3</button>
        </div>
        <div class="control-row">
            <input type="number" id="sBet" value="100" min="10">
            <button id="spinBtn" onclick="spin()">SPIN</button>
        </div>
        <div id="sRes" class="result"></div>
    </div>

    <div class="section">
        <div class="section-title"><span class="label">Blackjack</span></div>
        <div id="bjDCards" class="card-row"></div>
        <div id="bjPCards" class="card-row"></div>
        <div id="bjPScore" class="result">0</div>
        <div class="control-row" id="bjInit">
            <input type="number" id="bjBet" value="100">
            <button onclick="startBJ()">DEAL</button>
        </div>
        <div class="control-row" id="bjActions" style="display:none;">
            <button onclick="socket.emit('bj_hit')">HIT</button>
            <button onclick="standBJ()">STAND</button>
        </div>
        <div id="bjRes" class="result"></div>
    </div>

    <div class="section">
        <div class="section-title"><span class="label">High & Low</span></div>
        <div class="card-row">
            <div id="hlCurrent" class="card-ui">?</div>
            <div id="hlNext" class="card-ui back">?</div>
        </div>
        <div class="control-row" id="hlInit">
            <input type="number" id="hlBet" value="100">
            <button onclick="startHL()">DEAL</button>
        </div>
        <div class="control-row" id="hlActions" style="display:none;">
            <button onclick="guessHL('high')">HIGH</button>
            <button onclick="guessHL('low')">LOW</button>
            <button onclick="collectHL()">COLLECT</button>
        </div>
        <div id="hlRes" class="result"></div>
    </div>

    <div class="section">
        <div class="section-title"><span class="label">Ranking</span></div>
        <div id="rList"></div>
    </div>

    <div class="section chat-section">
        <div class="section-title"><span class="label">Global Chat</span></div>
        <div id="chat-log" style="height: 300px; background: #7494c0; border-radius: 8px; overflow-y: auto; margin: 10px 0;"></div>
        <div class="control-row">
            <input type="text" id="chatInput" placeholder="MESSAGE..." style="width:75%;">
            <button onclick="sendChat()">SEND</button>
        </div>
    </div>
</main>

<div id="log" style="width:100%; padding:20px; font-size:0.8rem; color:rgba(0,255,255,0.4); border-top:1px solid rgba(0,255,255,0.1);"></div>

<script>

    const socket = io();
    let myName = ""; // ‚Üê „Åì„Çå„ÇíËøΩÂä†ÔºÅ(‰ªä„ÅØÁ©∫„Å£„ÅΩ„Å†„Åë„Å©„ÄÅ„É≠„Ç∞„Ç§„É≥„Åó„ÅüÊôÇ„Å´Ëá™ÂàÜ„ÅÆÂêçÂâç„ÅåÂÖ•„ÇãÁÆ±„Åß„Åô)

// 1. „ÉÅ„ÉÉ„ÉóË°®Á§∫ÔºàHTML„ÅÆ id="chips" „Å´Âêà„Çè„Åõ„Åæ„Åó„ÅüÔºâ
function updateChips(amount) {
    const el = document.getElementById('chips');
    if (el && amount !== undefined) {
        el.textContent = amount;
    }
}

// 2. „É≠„Ç∞„Ç§„É≥ÔºàHTML„ÅÆ id="uName", id="uPass" „Å´Âêà„Çè„Åõ„Åæ„Åó„ÅüÔºâ
function login() {
    const name = document.getElementById('uName').value;
    const password = document.getElementById('uPass').value;
    const err = document.getElementById('err');
    
    if(!name || !password) {
        err.textContent = "ÂêçÂâç„Å®„Éë„Çπ„ÉØ„Éº„Éâ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ";
        return;
    }
    socket.emit('login_request', { name: name, password: password });
}

socket.on('login_success', d => {
    myName = d.name; // ‚Üê „Åì„Çå„ÇíËøΩÂä†ÔºÅ(„Åì„Åì„ÅßËá™ÂàÜ„ÅÆÂêçÂâç„Çí„ÄåÁÆ±„Äç„Å´‰øùÂ≠ò„Åó„Åæ„Åô)
    document.getElementById('loginOverlay').style.display = 'none';
    document.getElementById('myName').textContent = d.name;
    updateChips(d.chips);
});

socket.on('login_error', msg => {
    document.getElementById('err').textContent = msg;
});

// 3. „ÉÅ„É£„ÉÉ„ÉàÔºàHTML„ÅÆ id="chatInput", id="log" „Å´Âêà„Çè„Åõ„Åæ„Åó„ÅüÔºâ
function sendChat() {
    const input = document.getElementById('chatInput');
    if (input.value) {
        socket.emit('chat_message', input.value);
        input.value = '';
    }
}

socket.on('broadcast', (data) => {
    const chatLog = document.getElementById('chat-log');
    if (!chatLog) return; // „Åì„Åì„Åß„Ç®„É©„ÉºÔºànullÔºâ„ÇíÈò≤„ÅêÔºÅ

    // Ëá™ÂàÜ„ÅÆÂêçÂâç„Å®‰∏ÄËá¥„Åô„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØÔºàÂÜíÈ†≠„Åß let myName = ""; „Åó„Å¶„ÅÑ„ÇãÂâçÊèêÔºâ
    const isMe = (data.userName === myName);

    // 1. „É°„ÉÉ„Çª„Éº„Ç∏„ÅÆÂ§ñÊû†ÔºàÂêπ„ÅçÂá∫„ÅóÔºâ„Çí‰Ωú„Çã
    const msgDiv = document.createElement('div');
    msgDiv.className = isMe ? "msg-box msg-me" : "msg-box msg-other";
    msgDiv.textContent = data.message;

    // 2. ÂêçÂâç„ÇíË°®Á§∫„Åô„ÇãÈÉ®ÂàÜ„Çí‰Ωú„Çã
    const infoDiv = document.createElement('div');
    infoDiv.className = "msg-info";
    // Ëá™ÂàÜ„ÅÆ„Å®„Åç„ÅØ„Äå„ÅÇ„Å™„Åü„Äç„ÄÅÁõ∏Êâã„ÅÆ„Å®„Åç„ÅØ„Åù„ÅÆ‰∫∫„ÅÆÂêçÂâç„ÇíÂá∫„Åô„Å®ÂàÜ„Åã„Çä„ÇÑ„Åô„ÅÑ„Åß„Åô
    infoDiv.textContent = isMe ? "„ÅÇ„Å™„Åü" : data.userName;

    // 3. ÁîªÈù¢„Å´ËøΩÂä†„Åô„Çã
    chatLog.appendChild(infoDiv);
    chatLog.appendChild(msgDiv);

    // 4. Ëá™Âãï„Åß‰∏ÄÁï™‰∏ã„Åæ„Åß„Çπ„ÇØ„É≠„Éº„É´
    chatLog.scrollTop = chatLog.scrollHeight;
});

let finalResult = ["üçí", "üíé", "7Ô∏è‚É£"]; // „Çµ„Éº„Éê„Éº„Åã„Çâ„ÅÆÁµêÊûú„ÇíÊ†ºÁ¥ç
let intervals = [null, null, null];    // „Ç∑„É£„ÉÉ„Éï„É´Áî®„Çø„Ç§„Éû„Éº
let isSpinning = [false, false, false]; // ÂõûËª¢„Éï„É©„Ç∞

const symbols = ["üçí", "üíé", "7Ô∏è‚É£", "üçã", "‚≠ê", "üîî"];

// „Çπ„Éî„É≥ÈñãÂßã
function spin() {
    const bet = parseInt(document.getElementById('sBet').value) || 10;
    
    // UI„ÅÆ„É™„Çª„ÉÉ„Éà
    document.getElementById('spinBtn').disabled = true;
    document.getElementById('sRes').textContent = "";
    document.getElementById('gogoLamp').style.color = "#222";
    document.getElementById('gogoLamp').style.textShadow = "none";

    socket.emit('spin_request', { bet: bet });
}

// „Çµ„Éº„Éê„Éº„Åã„ÇâÁµêÊûú„ÅåÂ±ä„ÅÑ„Åü
socket.on('spin_result', d => {
    finalResult = d.result; // ÁµêÊûú„Çí‰øùÂ≠ò„Åó„Å¶„Åä„ÅèÔºà„Åæ„Å†Ë°®Á§∫„Åó„Å™„ÅÑÔºâ

    // 3„Å§„ÅÆ„É™„Éº„É´„ÇíÂõûËª¢Ôºà„Ç∑„É£„ÉÉ„Éï„É´Ôºâ„Åï„Åõ„Çã
    for (let i = 0; i < 3; i++) {
        isSpinning[i] = true;
        document.getElementById(`stop${i}`).disabled = false;
        
        // „Ç∑„É£„ÉÉ„Éï„É´ÊºîÂá∫ÈñãÂßã
        intervals[i] = setInterval(() => {
            document.getElementById(`reel${i}`).textContent = symbols[Math.floor(Math.random() * symbols.length)];
        }, 60);
    }
    
    // ÂÖ®„É™„Éº„É´„ÅåÊ≠¢„Åæ„Å£„ÅüÂæå„ÅÆÂá¶ÁêÜÁî®„Å´„Éá„Éº„Çø„Å†„Åë‰øùÊåÅ
    window.lastSpinData = d;
});

// ÂêÑÂÅúÊ≠¢„Éú„Çø„É≥„ÇíÊäº„Åó„ÅüÊôÇ
function stopReel(idx) {
    if (!isSpinning[idx]) return;

    clearInterval(intervals[idx]); // „Ç∑„É£„ÉÉ„Éï„É´ÂÅúÊ≠¢
    document.getElementById(`reel${idx}`).textContent = finalResult[idx]; // Êú¨Áâ©„ÅÆÁµêÊûú„ÇíË°®Á§∫
    document.getElementById(`stop${idx}`).disabled = true;
    isSpinning[idx] = false;

    // ÂÖ®ÈÉ®Ê≠¢„Åæ„Å£„Åü„ÅãÁ¢∫Ë™ç
    if (!isSpinning.includes(true)) {
        finishSpin();
    }
}

// ÂÖ®„É™„Éº„É´ÂÅúÊ≠¢Âæå„ÅÆÂá¶ÁêÜ
function finishSpin() {
    const d = window.lastSpinData;
    document.getElementById('spinBtn').disabled = false;
    updateChips(d.newChips);

    // WIN/LOSEË°®Á§∫
    const res = document.getElementById('sRes');
    res.textContent = d.win > 0 ? `WIN: ${d.win}ÊûöÔºÅ` : "LOSE";
    res.className = "result " + (d.win > 0 ? "win" : "lose");

    // 1/50„ÅÆ„Éö„Ç´„ÇäÊºîÂá∫Ôºà777„ÅÆÊôÇÔºâ
    if (finalResult.every(s => s === "7Ô∏è‚É£")) {
        const lamp = document.getElementById('gogoLamp');
        lamp.style.color = "#ff00ff";
        lamp.style.textShadow = "0 0 10px #fff, 0 0 20px #ff00ff";
        // „Éú„Éº„Éä„ÇπÁ¢∫ÂÆö„ÅÆSE„ÇÑ„Éê„Ç§„Éñ„Çí„Åì„Åì„Å´ÂÖ•„Çå„Å¶„ÇÇ„ÅÑ„ÅÑ„Åß„Åô„Å≠ÔºÅ
    }
}
    
// 5. „Éñ„É©„ÉÉ„ÇØ„Ç∏„É£„ÉÉ„ÇØÔºàHTML„ÅÆ id="bjDCards", id="bjPCards", id="bjPScore" „Å´Âêà„Çè„Åõ„Åæ„Åó„ÅüÔºâ
function startBJ() {
    const bet = parseInt(document.getElementById('bjBet').value) || 100;
    socket.emit('bj_start', { bet: bet });
    document.getElementById('bjInit').style.display = 'none';
    document.getElementById('bjActions').style.display = 'flex';
    document.getElementById('bjRes').textContent = "ÂãùË≤†‰∏≠...";
}

function standBJ() {
    socket.emit('bj_stand');
}

socket.on('bj_update', d => {
    renderCards('bjPCards', d.player);
    renderCards('bjDCards', d.dealer);
    document.getElementById('bjPScore').textContent = d.pSum;
});

socket.on('bj_result', d => {
    renderCards('bjPCards', d.player);
    renderCards('bjDCards', d.dealer);
    const res = document.getElementById('bjRes');
    res.textContent = d.msg;
    res.className = "result " + (d.msg.includes("WIN") ? "win" : "lose");

    updateChips(d.newChips);
    document.getElementById('bjInit').style.display = 'flex';
    document.getElementById('bjActions').style.display = 'none';
});

// 6. „Éè„Ç§„Ç¢„É≥„Éâ„É≠„ÉºÔºàHTML„ÅÆ id="hlCurrent", id="hlNext" „Å´Âêà„Çè„Åõ„Åæ„Åó„ÅüÔºâ
function startHL() {
    socket.emit('hl_start');
}

function guessHL(choice) {
    const bet = parseInt(document.getElementById('hlBet').value) || 100;
    socket.emit('hl_guess', { choice: choice, bet: bet });
}

function collectHL() {
    socket.emit('hl_collect');
    document.getElementById('hlInit').style.display = 'flex';
    document.getElementById('hlActions').style.display = 'none';
}

socket.on('hl_setup', d => {
    renderCards('hlCurrent', [d.currentCard]); 
    document.getElementById('hlInit').style.display = 'none';
    document.getElementById('hlActions').style.display = 'flex';
    document.getElementById('hlRes').textContent = "HIGH or LOW?";
});

socket.on('hl_result', d => {
    renderCards('hlCurrent', [d.oldCard]); 
    const res = document.getElementById('hlRes');
    res.textContent = d.msg;
    res.className = "result " + (d.msg.includes("WIN") ? "win" : "lose");
    updateChips(d.newChips);
});

// 7. „É©„É≥„Ç≠„É≥„Ç∞ÔºàHTML„ÅÆ id="rList" „Å´Âêà„Çè„Åõ„Åæ„Åó„ÅüÔºâ
socket.on('update_ranking', list => {
    const container = document.getElementById('rList');
    if (!container) return;
    container.innerHTML = list.map((u, i) => `
        <div style="border-bottom: 1px solid rgba(0,255,255,0.1); padding: 5px 0;">
            <span style="color:var(--accent2)">${i + 1}.</span> ${u.name} 
            <span style="float:right; color:#fcee0a;">${u.chips}</span>
        </div>
    `).join('');
});

// 8. „Ç´„Éº„ÉâÊèèÁîªÔºàHTML„ÅÆ .card-ui „Éá„Ç∂„Ç§„É≥„Å´Âêà„Çè„Åõ„Åæ„Åó„ÅüÔºâ
function renderCards(id, cards) {
    const el = document.getElementById(id);
    if (!el) return;
    el.innerHTML = cards.map(c => {
        if (c.rank === '?') return `<div class="card-ui back">?</div>`;
        const isRed = c.suit === '‚ô•' || c.suit === '‚ô¶';
        return `<div class="card-ui ${isRed ? 'red' : ''}">${c.rank}${c.suit}</div>`;
    }).join('');
}

socket.on('chat_history', (msgs) => {
    // ‚ùå ‰ª•Ââç„ÅÆ 'log' „Åß„ÅØ„Å™„Åè„ÄÅ‚úÖ 'chat-log' „ÇíÊåáÂÆö„Åô„Çã
    const chatLog = document.getElementById('chat-log');
    if (!chatLog) return;
    
    chatLog.innerHTML = ""; // ‰∏ÄÊó¶‰∏≠Ë∫´„ÇíÁ©∫„Å´„Åô„Çã

    msgs.forEach(data => {
        const isMe = (data.userName === myName);
        
        // ÂêçÂâçÔºàinfoDivÔºâ„Çí‰Ωú„Çã
        const infoDiv = document.createElement('div');
        infoDiv.className = "msg-info";
        infoDiv.textContent = data.userName;

        // Âêπ„ÅçÂá∫„ÅóÔºàmsgDivÔºâ„Çí‰Ωú„Çã
        const msgDiv = document.createElement('div');
        msgDiv.className = isMe ? "msg-box msg-me" : "msg-box msg-other";
        msgDiv.textContent = data.message;

        // ÊåáÂÆö„Åó„ÅüÊû†ÂÜÖ„Å´ËøΩÂä†
        chatLog.appendChild(infoDiv);
        chatLog.appendChild(msgDiv);
    });

    // ‰∏ÄÁï™‰∏ã„Åæ„Åß„Çπ„ÇØ„É≠„Éº„É´„Åï„Åõ„Çã
    chatLog.scrollTop = chatLog.scrollHeight;
});
    
</script>
</body>
</html>



















