<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>YAWATA CASINO</title>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <style>
        /* ã”æç¤ºã„ãŸã ã„ãŸãƒ‡ã‚¶ã‚¤ãƒ³ã‚’é©ç”¨ */
        :root{
            --bg:#050510;
            --accent:#0ff;
            --accent2:#ff00ff;
            --panel:#0b0b1a;
            --text:#e0ffff;
        }
        *{ box-sizing:border-box; }
        body{
            margin:0;
            min-height:100vh;
            background: radial-gradient(circle at top, #202040 0, #050510 55%, #000 100%);
            font-family: "Segoe UI", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
            color:var(--text);
            text-align:center;
            display:flex; flex-direction:column; align-items:center;
        }
        header{ padding:25px 10px 10px; }
        h1{
            margin:0; font-size:2.6rem; letter-spacing:0.15em;
            text-shadow: 0 0 10px var(--accent), 0 0 25px var(--accent2), 0 0 40px #fff;
        }
        h1 span{ display:inline-block; transform:skewX(-8deg); }
        #chipBar{
            margin-top:10px; display:inline-flex; align-items:center; gap:10px; padding:6px 14px;
            border-radius:999px; background:linear-gradient(90deg,rgba(0,255,255,0.15),rgba(255,0,255,0.15));
            border:1px solid rgba(0,255,255,0.5); box-shadow:0 0 15px rgba(0,255,255,0.4); font-weight:bold;
        }
        #chips{ font-size:1.4rem; color:#fff; text-shadow:0 0 8px var(--accent); }
        main{
            width:100%; max-width:1100px; padding:10px 15px 40px;
            display:grid; grid-template-columns:repeat(auto-fit,minmax(300px,1fr)); gap:20px;
        }
        .section{
            position:relative; background:radial-gradient(circle at top left,#1a1a3a,#050510 60%);
            border-radius:18px; padding:18px 16px 20px; border:1px solid rgba(0,255,255,0.4);
            box-shadow: 0 0 25px rgba(0,255,255,0.25), 0 0 40px rgba(255,0,255,0.15); overflow:hidden;
        }
        .control-row{ display:flex; justify-content:center; gap:8px; margin-bottom:10px; }
        input[type="number"], input[type="text"], input[type="password"] {
            padding:6px 12px; border-radius:999px; border:1px solid rgba(0,255,255,0.6);
            background:rgba(0,0,0,0.6); color:var(--text);
        }
        button{
            background:linear-gradient(135deg,#111,#222); color:var(--accent);
            border-radius:999px; border:1px solid rgba(0,255,255,0.7); padding:7px 18px;
            cursor:pointer; font-weight:600; transition: 0.1s;
        }
        button:hover{ background:var(--accent); color:#000; box-shadow:0 0 12px var(--accent); }
        .slot-frame{
            font-size:2.4rem; margin:10px 0; padding:6px 16px; border-radius:14px;
            border:1px solid rgba(0,255,255,0.6); background:rgba(0,0,0,0.5);
        }
        .result{ margin-top:8px; min-height:22px; font-weight:bold; }
        .win{ color:#00ff9d; text-shadow:0 0 8px #00ff9d; }
        .lose{ color:#ff4d6a; text-shadow:0 0 8px #ff4d6a; }
        #loginOverlay {
            position: fixed; inset: 0; background: var(--bg);
            display: flex; justify-content: center; align-items: center; z-index: 1000;
        }
        /* è¿½åŠ ãƒ»ä¿®æ­£ç”¨CSS */
.card-row {
    display: flex;
    justify-content: center;
    gap: 10px;
    min-height: 100px;
    padding: 10px;
}

/* ãŠå®¢æ§˜å®šç¾©ã®ã€Œcardã€ã‚’ç¶™æ‰¿ã—ãŸãƒˆãƒ©ãƒ³ãƒ—ãƒ‡ã‚¶ã‚¤ãƒ³ */
.card-ui {
    display: inline-flex;
    justify-content: center;
    align-items: center;
    width: 52px;
    height: 72px;
    border-radius: 10px;
    background: #fdfdfd; /* ç™½ãƒ™ãƒ¼ã‚¹ */
    color: #000;
    font-weight: bold;
    font-size: 1.2rem;
    box-shadow: 0 4px 10px rgba(0,0,0,0.5), 0 0 5px var(--accent);
    position: relative;
    border: 1px solid #ddd;
}

/* ãƒãƒ¼ãƒˆã‚„ãƒ€ã‚¤ãƒ¤ãªã©èµ¤ã„ã‚¹ãƒ¼ãƒˆç”¨ */
.card-ui.red { color: #c00; }

/* è£å‘ãã®ã‚«ãƒ¼ãƒ‰ */
.card-ui.back {
    background: linear-gradient(135deg, var(--accent) 0%, var(--accent2) 100%);
    border: 2px solid #fff;
}

#chatBox {
    height: 150px;
    overflow-y: auto;
    background: rgba(0,0,0,0.4);
    border: 1px solid rgba(0,255,255,0.2);
    border-radius: 8px;
    padding: 10px;
    text-align: left;
    font-size: 0.85rem;
    margin-top: 10px;
}

        .chat-message { display: flex; flex-direction: column; }
/* ç›¸æ‰‹ã®ç™ºè¨€ï¼ˆå·¦å¯„ã›ï¼‰ */
.message-other { align-self: flex-start; background: #e0e0e0; border-radius: 10px; padding: 8px; margin: 5px; }
/* è‡ªåˆ†ã®ç™ºè¨€ï¼ˆå³å¯„ã›ãƒ»ç·‘è‰²ï¼‰ */
.message-me { align-self: flex-end; background: #85e085; border-radius: 10px; padding: 8px; margin: 5px; }
        
    </style>
</head>
<body>

<div id="loginOverlay">
    <div class="section" style="width:320px;">
        <h2 style="color:var(--accent);">LOGIN / SIGNUP</h2>
        <div style="margin-top:20px;">
            <input type="text" id="uName" placeholder="PLAYER NAME" style="width:100%; margin-bottom:10px;"><br>
            <input type="password" id="uPass" placeholder="PASSWORD" style="width:100%; margin-bottom:20px;"><br>
            <button onclick="login()" style="width:100%;">ACCESS SYSTEM</button>
            <p id="err" style="color:var(--accent2); font-size:0.8rem; margin-top:10px;"></p>
        </div>
    </div>
</div>

<header>
    <h1><span>YAWATA</span> CASINO</h1>
    <div id="chipBar">
        STATUS: <span id="chips">0</span> CHIPS
    </div>
    <div style="margin-top:10px; font-size:0.9rem;">PLAYER: <span id="myName">-</span></div>
</header>

<main>
    
<div class="section">
    <div class="section-title"><span class="label">Cyber Slot</span></div>
    
    <div id="gogoLamp" style="color: #333; font-weight: bold; text-shadow: none; transition: 0.3s;">GOGO!</div>

    <div class="slot-frame" style="display: flex; justify-content: center; gap: 10px;">
        <div id="reel0" class="reel">â“</div>
        <div id="reel1" class="reel">â“</div>
        <div id="reel2" class="reel">â“</div>
    </div>

    <div class="control-row">
        <button id="btn0" onclick="stopReel(0)" disabled>STOP 1</button>
        <button id="btn1" onclick="stopReel(1)" disabled>STOP 2</button>
        <button id="btn2" onclick="stopReel(2)" disabled>STOP 3</button>
    </div>

    <div class="control-row">
        <input type="number" id="sBet" value="100" min="10">
        <button id="spinBtn" onclick="spin()">SPIN</button>
    </div>
    <div id="sRes" class="result"></div>
</div>

<div class="section">
    <div class="section-title"><span class="label">Blackjack</span></div>
    <div id="bjTable" style="margin-bottom:15px; background:rgba(0,0,0,0.3); border-radius:10px; padding:10px;">
        <div style="font-size:0.8rem; color:var(--accent); margin-bottom:5px;">DEALER</div>
        <div id="bjDCards" class="card-row"></div>
        
        <div style="margin:15px 0; border-top:1px dashed rgba(0,255,255,0.2);"></div>
        
        <div id="bjPCards" class="card-row"></div>
        <div style="font-size:0.8rem; color:var(--accent2); margin-top:5px;">YOU: <span id="bjPScore">0</span></div>
    </div>
    
    <div class="control-row" id="bjInit">
        <input type="number" id="bjBet" value="100">
        <button onclick="startBJ()">DEAL</button>
    </div>
    
    <div class="control-row" id="bjActions" style="display:none;">
        <button onclick="socket.emit('bj_hit')" style="border-color:var(--accent2); color:var(--accent2);">HIT</button>
        <button onclick="standBJ()">STAND</button>
    </div>
    <div id="bjRes" class="result"></div>
</div>

<div class="section">
    <div class="section-title"><span class="label">High & Low</span></div>
    <div class="card-row" style="align-items: center; gap: 20px;">
        <div>
            <div style="font-size:0.7rem; opacity:0.6; margin-bottom:5px;">CURRENT</div>
            <div id="hlCurrent" class="card-ui back">?</div>
        </div>
        <div style="font-size:1.5rem; color:var(--accent); text-shadow:0 0 10px var(--accent);">â¡</div>
        <div>
            <div style="font-size:0.7rem; opacity:0.6; margin-bottom:5px;">NEXT</div>
            <div id="hlNext" class="card-ui back">?</div>
        </div>
    </div>
    
    <div class="control-row" id="hlInit" style="margin-top:15px;">
        <input type="number" id="hlBet" value="100">
        <button onclick="startHL()">DEAL</button>
    </div>
    
    <div class="control-row" id="hlActions" style="display:none; margin-top:15px;">
        <button onclick="guessHL('high')" style="border-color:var(--accent2); color:var(--accent2);">HIGH â†‘</button>
        <button onclick="guessHL('low')">LOW â†“</button>
        <button onclick="collectHL()" style="border-color:#ffcc00; color:#ffcc00;">COLLECT (çµ‚äº†)</button>
    </div>
    <div id="hlRes" class="result"></div>
</div>

    <div class="section">
        <div class="section-title"><span class="label">Ranking</span></div>
        <div id="rList" style="text-align:left; padding:10px; font-size:0.9rem;"></div>
    </div>

    <div class="section" style="grid-column: 1 / -1;">
        <div class="section-title"><span class="label">Global Chat</span></div>
        <div class="control-row">
            <input type="text" id="chatInput" placeholder="MESSAGE..." style="width:70%;">
            <button onclick="sendChat()">SEND</button>
        </div>
    </div>
    
</main>

<div id="log" style="width:100%; padding:20px; font-size:0.8rem; color:rgba(0,255,255,0.4); border-top:1px solid rgba(0,255,255,0.1);"></div>

<script>

    const socket = io();

// 1. ãƒãƒƒãƒ—è¡¨ç¤ºï¼ˆHTMLã® id="chips" ã«åˆã‚ã›ã¾ã—ãŸï¼‰
function updateChips(amount) {
    const el = document.getElementById('chips');
    if (el && amount !== undefined) {
        el.textContent = amount;
    }
}

// 2. ãƒ­ã‚°ã‚¤ãƒ³ï¼ˆHTMLã® id="uName", id="uPass" ã«åˆã‚ã›ã¾ã—ãŸï¼‰
function login() {
    const name = document.getElementById('uName').value;
    const password = document.getElementById('uPass').value;
    const err = document.getElementById('err');
    
    if(!name || !password) {
        err.textContent = "åå‰ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„";
        return;
    }
    socket.emit('login_request', { name: name, password: password });
}

socket.on('login_success', d => {
    document.getElementById('loginOverlay').style.display = 'none';
    document.getElementById('myName').textContent = d.name;
    updateChips(d.chips);
});

socket.on('login_error', msg => {
    document.getElementById('err').textContent = msg;
});

// 3. ãƒãƒ£ãƒƒãƒˆï¼ˆHTMLã® id="chatInput", id="log" ã«åˆã‚ã›ã¾ã—ãŸï¼‰
function sendChat() {
    const input = document.getElementById('chatInput');
    if (input.value) {
        socket.emit('chat_message', input.value);
        input.value = '';
    }
}

socket.on('broadcast', msg => {
    const log = document.getElementById('log');
    const div = document.createElement('div');
    div.style.borderLeft = "2px solid var(--accent)";
    div.style.paddingLeft = "8px";
    div.style.marginBottom = "4px";
    div.textContent = msg;
    log.appendChild(div);
    log.scrollTop = log.scrollHeight;
});

let finalResult = ["ğŸ’", "ğŸ’", "7ï¸âƒ£"]; // ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ã®çµæœã‚’æ ¼ç´
let intervals = [null, null, null];    // ã‚·ãƒ£ãƒƒãƒ•ãƒ«ç”¨ã‚¿ã‚¤ãƒãƒ¼
let isSpinning = [false, false, false]; // å›è»¢ãƒ•ãƒ©ã‚°

const symbols = ["ğŸ’", "ğŸ’", "7ï¸âƒ£", "ğŸ‹", "â­", "ğŸ””"];

// ã‚¹ãƒ”ãƒ³é–‹å§‹
function spin() {
    const bet = parseInt(document.getElementById('sBet').value) || 10;
    
    // UIã®ãƒªã‚»ãƒƒãƒˆ
    document.getElementById('spinBtn').disabled = true;
    document.getElementById('sRes').textContent = "";
    document.getElementById('gogoLamp').style.color = "#222";
    document.getElementById('gogoLamp').style.textShadow = "none";

    socket.emit('spin_request', { bet: bet });
}

// ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰çµæœãŒå±Šã„ãŸ
socket.on('spin_result', d => {
    finalResult = d.result; // çµæœã‚’ä¿å­˜ã—ã¦ãŠãï¼ˆã¾ã è¡¨ç¤ºã—ãªã„ï¼‰

    // 3ã¤ã®ãƒªãƒ¼ãƒ«ã‚’å›è»¢ï¼ˆã‚·ãƒ£ãƒƒãƒ•ãƒ«ï¼‰ã•ã›ã‚‹
    for (let i = 0; i < 3; i++) {
        isSpinning[i] = true;
        document.getElementById(`stop${i}`).disabled = false;
        
        // ã‚·ãƒ£ãƒƒãƒ•ãƒ«æ¼”å‡ºé–‹å§‹
        intervals[i] = setInterval(() => {
            document.getElementById(`reel${i}`).textContent = symbols[Math.floor(Math.random() * symbols.length)];
        }, 60);
    }
    
    // å…¨ãƒªãƒ¼ãƒ«ãŒæ­¢ã¾ã£ãŸå¾Œã®å‡¦ç†ç”¨ã«ãƒ‡ãƒ¼ã‚¿ã ã‘ä¿æŒ
    window.lastSpinData = d;
});

// å„åœæ­¢ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ãŸæ™‚
function stopReel(idx) {
    if (!isSpinning[idx]) return;

    clearInterval(intervals[idx]); // ã‚·ãƒ£ãƒƒãƒ•ãƒ«åœæ­¢
    document.getElementById(`reel${idx}`).textContent = finalResult[idx]; // æœ¬ç‰©ã®çµæœã‚’è¡¨ç¤º
    document.getElementById(`stop${idx}`).disabled = true;
    isSpinning[idx] = false;

    // å…¨éƒ¨æ­¢ã¾ã£ãŸã‹ç¢ºèª
    if (!isSpinning.includes(true)) {
        finishSpin();
    }
}

// å…¨ãƒªãƒ¼ãƒ«åœæ­¢å¾Œã®å‡¦ç†
function finishSpin() {
    const d = window.lastSpinData;
    document.getElementById('spinBtn').disabled = false;
    updateChips(d.newChips);

    // WIN/LOSEè¡¨ç¤º
    const res = document.getElementById('sRes');
    res.textContent = d.win > 0 ? `WIN: ${d.win}æšï¼` : "LOSE";
    res.className = "result " + (d.win > 0 ? "win" : "lose");

    // 1/50ã®ãƒšã‚«ã‚Šæ¼”å‡ºï¼ˆ777ã®æ™‚ï¼‰
    if (finalResult.every(s => s === "7ï¸âƒ£")) {
        const lamp = document.getElementById('gogoLamp');
        lamp.style.color = "#ff00ff";
        lamp.style.textShadow = "0 0 10px #fff, 0 0 20px #ff00ff";
        // ãƒœãƒ¼ãƒŠã‚¹ç¢ºå®šã®SEã‚„ãƒã‚¤ãƒ–ã‚’ã“ã“ã«å…¥ã‚Œã¦ã‚‚ã„ã„ã§ã™ã­ï¼
    }
}
    
// 5. ãƒ–ãƒ©ãƒƒã‚¯ã‚¸ãƒ£ãƒƒã‚¯ï¼ˆHTMLã® id="bjDCards", id="bjPCards", id="bjPScore" ã«åˆã‚ã›ã¾ã—ãŸï¼‰
function startBJ() {
    const bet = parseInt(document.getElementById('bjBet').value) || 100;
    socket.emit('bj_start', { bet: bet });
    document.getElementById('bjInit').style.display = 'none';
    document.getElementById('bjActions').style.display = 'flex';
    document.getElementById('bjRes').textContent = "å‹è² ä¸­...";
}

function standBJ() {
    socket.emit('bj_stand');
}

socket.on('bj_update', d => {
    renderCards('bjPCards', d.player);
    renderCards('bjDCards', d.dealer);
    document.getElementById('bjPScore').textContent = d.pSum;
});

socket.on('bj_result', d => {
    renderCards('bjPCards', d.player);
    renderCards('bjDCards', d.dealer);
    const res = document.getElementById('bjRes');
    res.textContent = d.msg;
    res.className = "result " + (d.msg.includes("WIN") ? "win" : "lose");

    updateChips(d.newChips);
    document.getElementById('bjInit').style.display = 'flex';
    document.getElementById('bjActions').style.display = 'none';
});

// 6. ãƒã‚¤ã‚¢ãƒ³ãƒ‰ãƒ­ãƒ¼ï¼ˆHTMLã® id="hlCurrent", id="hlNext" ã«åˆã‚ã›ã¾ã—ãŸï¼‰
function startHL() {
    socket.emit('hl_start');
}

function guessHL(choice) {
    const bet = parseInt(document.getElementById('hlBet').value) || 100;
    socket.emit('hl_guess', { choice: choice, bet: bet });
}

function collectHL() {
    socket.emit('hl_collect');
    document.getElementById('hlInit').style.display = 'flex';
    document.getElementById('hlActions').style.display = 'none';
}

socket.on('hl_setup', d => {
    renderCards('hlCurrent', [d.currentCard]); 
    document.getElementById('hlInit').style.display = 'none';
    document.getElementById('hlActions').style.display = 'flex';
    document.getElementById('hlRes').textContent = "HIGH or LOW?";
});

socket.on('hl_result', d => {
    renderCards('hlCurrent', [d.oldCard]); 
    const res = document.getElementById('hlRes');
    res.textContent = d.msg;
    res.className = "result " + (d.msg.includes("WIN") ? "win" : "lose");
    updateChips(d.newChips);
});

// 7. ãƒ©ãƒ³ã‚­ãƒ³ã‚°ï¼ˆHTMLã® id="rList" ã«åˆã‚ã›ã¾ã—ãŸï¼‰
socket.on('update_ranking', list => {
    const container = document.getElementById('rList');
    if (!container) return;
    container.innerHTML = list.map((u, i) => `
        <div style="border-bottom: 1px solid rgba(0,255,255,0.1); padding: 5px 0;">
            <span style="color:var(--accent2)">${i + 1}.</span> ${u.name} 
            <span style="float:right; color:#fcee0a;">${u.chips}</span>
        </div>
    `).join('');
});

// 8. ã‚«ãƒ¼ãƒ‰æç”»ï¼ˆHTMLã® .card-ui ãƒ‡ã‚¶ã‚¤ãƒ³ã«åˆã‚ã›ã¾ã—ãŸï¼‰
function renderCards(id, cards) {
    const el = document.getElementById(id);
    if (!el) return;
    el.innerHTML = cards.map(c => {
        if (c.rank === '?') return `<div class="card-ui back">?</div>`;
        const isRed = c.suit === 'â™¥' || c.suit === 'â™¦';
        return `<div class="card-ui ${isRed ? 'red' : ''}">${c.rank}${c.suit}</div>`;
    }).join('');
}

    // ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰éå»ãƒ­ã‚°ãŒå±Šã„ãŸã‚‰è¡¨ç¤ºã™ã‚‹
socket.on('chat_history', (msgs) => {
    const log = document.getElementById('log');
    log.innerHTML = ""; // ä¸€æ—¦ã‚¯ãƒªã‚¢ï¼ˆäºŒé‡è¡¨ç¤ºé˜²æ­¢ï¼‰
    msgs.forEach(msg => {
        const div = document.createElement('div');
        div.style.borderLeft = "2px solid var(--accent)";
        div.style.paddingLeft = "8px";
        div.style.marginBottom = "4px";
        div.textContent = msg;
        log.appendChild(div);
    });
    log.scrollTop = log.scrollHeight;
});
    
</script>
</body>
</html>














